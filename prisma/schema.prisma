datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

model LearningPreference {
  id    String @id @default(cuid())
  name  String
  level Int
}

model LearningGoal {
  id      String @id @default(cuid())
  content String
}

model Recommendation {
  id          String @id @default(cuid())
  title       String
  description String
  relatedSkill String
  type        String
  tutor       String?
  docLink     String?
  feedback    String?
}

model LearningProgress {
  id       String @id @default(cuid())
  skill    String
  progress Int
}

model Document {
  id          String   @id @default(uuid())
  title       String
  size        String
  uploadedAt  DateTime
  author      String
  subject     String
  topic       String
  keywords    Json? 
}

model Mentee {
  id                Int              @id @default(autoincrement())
  name              String
  email             String
  major             String
  year              Int
  className         String
  avatar            String
  phone             String
  progress          String

  nextSession       Json?  
  previousFeedbacks MenteeFeedback[]
  notes             MenteeNote[]
}

model MenteeNote {
  id        Int      @id @default(autoincrement())
  tutorId   Int
  menteeId  Int
  content   String
  createdAt DateTime @default(now())

  mentee Mentee @relation(fields: [menteeId], references: [id])
}

model MenteeFeedback {
  id         Int      @id @default(autoincrement())
  studentId  Int
  sessionId  Int
  rating     Json     
  comment    String?
  createdAt  DateTime @default(now())

  mentee Mentee @relation(fields: [studentId], references: [id])
}

model Profile {
  id           Int      @id @default(autoincrement())
  name         String
  email        String   @unique
  role         String   // 'student' hoặc 'tutor'
  faculty      String?
  phone        String?
  
  major        String?
  class        String?
  supportNeeds String?
  
  expertise    String?
  rating       Float?   @default(0)
  
  skills       Json?
  avail        Json?

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model TutorWorkload {
  id                Int      @id @default(autoincrement())
  
  tutorRefId        Int     
  tutorName         String
  tutorEmail        String
  tutorRole         String
  tutorMajor        String
  tutorRating       Float

  totalMentees      Int
  maxMentees        Int
  totalSessions     Int
  completedSessions Int
  totalHours        Int
  avgCompletionRate Float
}

model Topic {
  id        String    @id @default(cuid())
  title     String
  author    String    
  createdAt DateTime  @default(now())
  comments  Comment[]
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  author    String
  level     Int      @default(0)
  createdAt DateTime @default(now())
  
  topicId   String
  topic     Topic    @relation(fields: [topicId], references: [id], onDelete: Cascade)

  parentId  String?
  parent    Comment?  @relation("ParentChild", fields: [parentId], references: [id])
  children  Comment[] @relation("ParentChild")
}

model Session {
  id              Int      @id @default(autoincrement())
  programId       Int
  tutorId         Int
  studentId       Int
  mode            String   // 'online' | 'offline'
  location        String
  time            DateTime
  status          String   // 'pending', 'confirmed', 'completed', 'cancelled'
  subject         String
  meetingReport   String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  confirmedAt     DateTime?
  completedAt     DateTime?

  feedbacks       SessionFeedback[]
  tutorFeedbacks  TutorFeedback[]
}

model SessionFeedback {
  id                 Int      @id @default(autoincrement())
  studentId          Int
  comment            String
  createdAt          DateTime @default(now())
  
  practicalRelevance Int      @default(0)
  knowledgeLoad      Int      @default(0)
  clarity            Int      @default(0)
  enthusiasm         Int      @default(0)
  goalTransmission   Int      @default(0)

  sessionId          Int
  session            Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

model TutorFeedback {
  id        Int      @id @default(autoincrement())
  tutorId   Int
  studentId Int
  rating    Int
  comment   String
  createdAt DateTime @default(now())

  sessionId Int
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

model ReportSummary {
  id               Int     @id @default(autoincrement())
  semester         String  // Ví dụ: '2025A'
  totalTutors      Int
  totalStudents    Int
  totalSessions    Int
  avgFeedbackScore Float
  completionRate   Float
}

model DetailedReport {
  id                Int     @id @default(autoincrement())
  
  programId         Int
  programTitle      String
  programDesc       String
  programCategory   String
  programCapacity   Int
  programEnrolled   Int
  programSlots      Int
  programStatus     String

  tutorCount        Int
  menteeCount       Int
  avgScore          Float
  completedSessions Int
  ongoingSessions   Int
}

model AcademicTutor {
  id        Int      @id @default(autoincrement())
  name      String
  major     String
  rating    Float
  avail     String   
  
  programs  AcademicProgram[]
}

model AcademicProgram {
  id             Int      @id 
  title          String
  code           String
  description    String
  category       String
  field          String
  capacity       Int
  enrolledCount  Int      @default(0)
  availableSlots Int
  startDate      String
  endDate        String
  status         String
  createdBy      Int

  tutors        AcademicTutor[]
  registrations AcademicRegistration[]
}

model AcademicRegistration {
  id           Int      @id @default(autoincrement())
  studentId    Int
  tutorId      Int?     
  status       String   // 'pending' | 'confirmed'
  registeredAt DateTime @default(now())

  programId    Int
  program      AcademicProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
}